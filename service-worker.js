!function(e){var n={};function r(t){if(n[t])return n[t].exports;var o=n[t]={i:t,l:!1,exports:{}};return e[t].call(o.exports,o,o.exports,r),o.l=!0,o.exports}r.m=e,r.c=n,r.d=function(e,n,t){r.o(e,n)||Object.defineProperty(e,n,{enumerable:!0,get:t})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,n){if(1&n&&(e=r(e)),8&n)return e;if(4&n&&"object"==typeof e&&e&&e.__esModule)return e;var t=Object.create(null);if(r.r(t),Object.defineProperty(t,"default",{enumerable:!0,value:e}),2&n&&"string"!=typeof e)for(var o in e)r.d(t,o,function(n){return e[n]}.bind(null,o));return t},r.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(n,"a",n),n},r.o=function(e,n){return Object.prototype.hasOwnProperty.call(e,n)},r.p="",r(r.s=87)}({16:function(e,n,r){var t=r(83),o=r(85);e.exports=t("v5",80,o)},83:function(e,n,r){var t=r(84);e.exports=function(e,n,r){var o=function(e,o,i,u){var c=i&&u||0;if("string"==typeof e&&(e=function(e){e=unescape(encodeURIComponent(e));for(var n=new Array(e.length),r=0;r<e.length;r++)n[r]=e.charCodeAt(r);return n}(e)),"string"==typeof o&&(o=function(e){var n=[];return e.replace(/[a-fA-F0-9]{2}/g,(function(e){n.push(parseInt(e,16))})),n}(o)),!Array.isArray(e))throw TypeError("value must be an array of bytes");if(!Array.isArray(o)||16!==o.length)throw TypeError("namespace must be uuid string or an Array of 16 byte values");var a=r(o.concat(e));if(a[6]=15&a[6]|n,a[8]=63&a[8]|128,i)for(var s=0;s<16;++s)i[c+s]=a[s];return i||t(a)};try{o.name=e}catch(e){}return o.DNS="6ba7b810-9dad-11d1-80b4-00c04fd430c8",o.URL="6ba7b811-9dad-11d1-80b4-00c04fd430c8",o}},84:function(e,n){for(var r=[],t=0;t<256;++t)r[t]=(t+256).toString(16).substr(1);e.exports=function(e,n){var t=n||0,o=r;return[o[e[t++]],o[e[t++]],o[e[t++]],o[e[t++]],"-",o[e[t++]],o[e[t++]],"-",o[e[t++]],o[e[t++]],"-",o[e[t++]],o[e[t++]],"-",o[e[t++]],o[e[t++]],o[e[t++]],o[e[t++]],o[e[t++]],o[e[t++]]].join("")}},85:function(e,n,r){"use strict";function t(e,n,r,t){switch(e){case 0:return n&r^~n&t;case 1:return n^r^t;case 2:return n&r^n&t^r&t;case 3:return n^r^t}}function o(e,n){return e<<n|e>>>32-n}e.exports=function(e){var n=[1518500249,1859775393,2400959708,3395469782],r=[1732584193,4023233417,2562383102,271733878,3285377520];if("string"==typeof e){var i=unescape(encodeURIComponent(e));e=new Array(i.length);for(var u=0;u<i.length;u++)e[u]=i.charCodeAt(u)}e.push(128);var c=e.length/4+2,a=Math.ceil(c/16),s=new Array(a);for(u=0;u<a;u++){s[u]=new Array(16);for(var f=0;f<16;f++)s[u][f]=e[64*u+4*f]<<24|e[64*u+4*f+1]<<16|e[64*u+4*f+2]<<8|e[64*u+4*f+3]}for(s[a-1][14]=8*(e.length-1)/Math.pow(2,32),s[a-1][14]=Math.floor(s[a-1][14]),s[a-1][15]=8*(e.length-1)&4294967295,u=0;u<a;u++){for(var l=new Array(80),d=0;d<16;d++)l[d]=s[u][d];for(d=16;d<80;d++)l[d]=o(l[d-3]^l[d-8]^l[d-14]^l[d-16],1);var h=r[0],p=r[1],y=r[2],m=r[3],v=r[4];for(d=0;d<80;d++){var b=Math.floor(d/20),g=o(h,5)+t(b,p,y,m)+v+n[b]+l[d]>>>0;v=m,m=y,y=o(p,30)>>>0,p=h,h=g}r[0]=r[0]+h>>>0,r[1]=r[1]+p>>>0,r[2]=r[2]+y>>>0,r[3]=r[3]+m>>>0,r[4]=r[4]+v>>>0}return[r[0]>>24&255,r[0]>>16&255,r[0]>>8&255,255&r[0],r[1]>>24&255,r[1]>>16&255,r[1]>>8&255,255&r[1],r[2]>>24&255,r[2]>>16&255,r[2]>>8&255,255&r[2],r[3]>>24&255,r[3]>>16&255,r[3]>>8&255,255&r[3],r[4]>>24&255,r[4]>>16&255,r[4]>>8&255,255&r[4]]}},87:function(e,n,r){"use strict";r.r(n);var t=r(16),o=r.n(t);function i(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);n&&(t=t.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),r.push.apply(r,t)}return r}function u(e,n,r){return n in e?Object.defineProperty(e,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[n]=r,e}function c(e,n){for(var r=0;r<n.length;r++){var t=n[r];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(e,t.key,t)}}var a=[{name:"remarks",key:"localGuid"},{name:"statuses",key:"localGuid"},{name:"prescriptions",key:"localGuid"},{name:"files",key:"localGuid"}],s=new(function(){function e(n){!function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,e);var r=n.name,t=n.version,o=n.objects;this.name=r,this.version=t,this.objects=o,this.isReady=null,this._init()}var n,r,t;return n=e,(r=[{key:"_init",value:function(){var e=this;return new Promise((function(n,r){var t=indexedDB.open(e.name,e.version);t.onsuccess=function(){e.api=t.result,n()},t.onupgradeneeded=function(){e.api=t.result,a.forEach((function(e){s.api.objectStoreNames.contains(e.name)||s.api.createObjectStore(e.name,{keyPath:e.key})})),n()},t.onerror=function(e){r(e)}})).then((function(){e.isReady=!0,console.log("indexedDB успешно создано")})).catch((function(n){e.isReady=!1,console.error("Ошибка создания indexedDB",n)}))}},{key:"ready",value:function(){var e=this;return this.isReady?Promise.resolve():!1===this.isReady?Promise.reject():new Promise((function(n){setTimeout((function(){n(e.ready())}),100)}))}},{key:"getAll",value:function(e){var n=this;return new Promise((function(r,t){n.ready().then((function(){var o=n.api.transaction(e,"readonly").objectStore(e).getAll();o.onsuccess=function(){r(o.result||[])},o.onerror=function(){t(o.error)}}))}))}},{key:"deleteRecord",value:function(e,n){var r=this;return new Promise((function(t,o){r.ready().then((function(){var i=r.api.transaction(e,"readwrite").objectStore(e).delete(n);i.onsuccess=function(){t({result:"ok"})},i.onerror=function(){o(i.error)}}))}))}},{key:"addRecord",value:function(e,n){var r=this;return new Promise((function(t,i){r.ready().then((function(){var u=r.api.transaction(e,"readwrite").objectStore(e);n.localGuid=n.id||n.localGuid||o()(JSON.stringify(n),o.a.URL);var c=u.put(n);c.onsuccess=function(){t(n)},c.onerror=function(){i(c.error)}}))}))}},{key:"addFile",value:function(e,n,r){var t=this;return new Promise((function(c,a){t.ready().then((function(){var s=t.api.transaction(e,"readwrite").objectStore(e);r.localGuid=r.id||r.localGuid||o()(JSON.stringify(r),o.a.URL);var f=s.put(function(e){for(var n=1;n<arguments.length;n++){var r=null!=arguments[n]?arguments[n]:{};n%2?i(r,!0).forEach((function(n){u(e,n,r[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):i(r).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))}))}return e}({},r,{url:n}));f.onsuccess=function(){c(r)},f.onerror=function(){a(f.error)}}))}))}},{key:"getFile",value:function(e,n){var r=this;return new Promise((function(t,o){r.ready().then((function(){var i=r.api.transaction(e,"readonly").objectStore(e).get(n);i.onsuccess=function(){t(i.result)},i.onerror=function(){o(i.error)}}))}))}},{key:"deleteFile",value:function(e,n){var r=this;return new Promise((function(t,o){r.ready().then((function(){var i=r.api.transaction(e,"readwrite").objectStore(e).delete(n);i.onsuccess=function(){t()},i.onerror=function(){o(i.error)}}))}))}}])&&c(n.prototype,r),t&&c(n,t),e}())({name:"sarex-db",version:1,objects:a}),f=s,l="static-cache",d="response-cache",h="https://sarex111.io";function p(e){return fetch(e).then((function(n){return 200===n.status?/javascript|html|css/.test(n.headers.get("Content-Type"))?caches.open(l).then((function(r){return r.put(e,n.clone()).then((function(){return n}))})):caches.open(d).then((function(r){return r.put(e,n.clone()).then((function(){return n}))})):n}))}function y(e){return fetch(e)}self.addEventListener("fetch",(function(e){e.respondWith(function(e){if(e.url.match(h))return function(e){if(e.url.match("/remarks"))return function(e){if("GET"===e.method)return f.getAll("remarks").then((function(e){return e}));if("POST"===e.method||"PUT"===e.method)return e.clone().json().then((function(e){return n=e,f.addRecord("remarks",n).then((function(e){return e}));var n}));if("DELETE"===e.method)return e.clone().json().then((function(e){return function(e){return f.deleteRecord("remarks",e).then((function(e){return e}))}(e.id||e.localGuid)}));return Promise.reject()}(e);if(e.url.match("/status"))return function(e){if("GET"===e.method)return f.getAll("statuses").then((function(e){return e}));if("POST"===e.method||"PUT"===e.method)return e.clone().json().then((function(e){return function(e){return f.addRecord("statuses",e).then((function(e){return e}))}(e)}));return Promise.reject()}(e);if(e.url.match("/prescriptions"))return function(e){if("GET"===e.method)return f.getAll("prescriptions").then((function(e){return e}));if("POST"===e.method||"PUT"===e.method)return e.clone().json().then((function(e){return function(e){return f.addRecord("prescriptions",e).then((function(e){return e}))}(e)}));if("DELETE"===e.method)return e.clone().json().then((function(e){return function(e){return f.deleteRecord("prescriptions",e).then((function(e){return e}))}(e.id||e.localGuid)}));return Promise.reject()}(e);if(e.url.match("/files"))return function(e){if("GET"===e.method)return function(e){return f.getFile("files",e).then((function(e){return e}))}(e.url.replace(/.+\//,""));if("POST"===e.method)return e.json().then((function(e){return n=e.url,r=e.data,f.addFile("files",n,r).then((function(e){return e}));var n,r}));if("DELETE"===e.method)return function(e){return f.deleteFile("files",e).then((function(e){return e}))}(e.url.replace(/.+\//,""));return Promise.reject()}(e);return y(e)}(e).then((function(e){return function(e){return new Response(JSON.stringify(e),{headers:{"content-type":"application/json"}})}(e)})).catch((function(e){return n={error:{message:e.message}},new Response(JSON.stringify(n),{headers:{"content-type":"application/json"},status:500});var n}));if("GET"===e.method&&!e.url.match("chrome-extension")&&!e.url.match("http://localhost"))return caches.open(d).then((function(n){return n.match(e).then((function(n){return n||caches.open(l).then((function(n){return n.match(e)})).then((function(n){return n?(p(e),n):p(e)}))}))}));return y(e)}(e.request))})),self.addEventListener("message",(function(e){var n=e.data,r=void 0===n?{}:n;switch(r.action){case"getCacheRecord":getCacheRecord(r.name);break;case"setCacheRecord":setCacheRecord(r)}}))}});